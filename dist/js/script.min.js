(()=>{"use strict";class t{constructor(t,e){this.selectors=t,this.opt=void 0!==e?e:{},this.curInd=0,this.prevInd=0,this.action=0,this.defualtOptions={infinity:!1,slide:{preView:0,position:"left",step:0},columnGap:0,currentClass:"current",transitionTime:400,counterInDot:!1,keyboardEvent:!0,swipeEvent:!0,swipeEventOpt:{sensitivity:1},slideGroup:1,autoViewSlide:!1,autoViewSlideOpt:{time:0,direction:"right"},breakpoint:{}},this.#t(),this.#e(this.opt),this.#i(),console.log("this.opt:",this.opt),this.validKeyElements&&(this.#s(),this.#n(),this.#o(!0),this.#h(),this.viewSlide())}#r(t,e){console.log(`ERROR --- ${t} (${e})`)}#t(){this.$slider=document.querySelector(this.#l(this.selectors.sliderSelector,"slider")),this.$slider&&(this.$slides=this.$slider.querySelectorAll(this.#l(this.selectors.slideSelector,"slides"))),this.validKeyElements&&(this.$prevBtn=this.$slider.querySelector(this.#l(this.selectors.prevBtnSelector,"prev btn")),this.$nextBtn=this.$slider.querySelector(this.#l(this.selectors.nextBtnSelector,"next btn")),this.$dot=this.$slider.querySelector(this.#l(this.selectors.dotSelector,"dot")),this.$counter=this.$slider.querySelector(this.#l(this.selectors.counterSelector,"counter")),this.$wrap=this.$slides[0].parentElement)}#l(t,e){return null!=t&&("string"==typeof t&&""!==(t=t.trim())&&/[.#]\w+/.test(t)||(t=void 0,this.#r(e,"invalid selector"))),void 0!==t&&"slides"!==e&&"slider"!==e&&(this.$slider.querySelectorAll(t).length>1?(t=void 0,this.#r(e,">1 elements")):this.$slider.querySelector(t)||this.#r(e,"can`t find element")),"slider"===e&&!document.querySelector(t)&&this.#r(e,"can`t find element"),"slides"===e&&!this.$slider.querySelector(t)&&this.#r(e,"can`t find element"),t}#e(t,e,i){const s=e||this.defualtOptions;if("object"!=typeof t||Array.isArray(t))this.#r(i,"invalid value(!use defualt value!)");else for(let e in t){const n=i?i+e[0].toUpperCase()+e.slice(1):e;"number"==typeof s[e]?t[e]=this.#d(t[e],s[e],n):"string"==typeof s[e]?t[e]=this.#p(t[e],s[e],n):"boolean"==typeof s[e]?t[e]=this.#a(t[e],s[e],n):"object"==typeof s[e]&&this.#e(t[e],s[e],n)}}#i(){this.opt=Object.assign(Object.assign({},this.defualtOptions),this.opt),this.opt.slide=Object.assign(Object.assign({},this.defualtOptions.slide),this.opt.slide),this.opt.swipeEventOpt=Object.assign(Object.assign({},this.defualtOptions.swipeEventOpt),this.opt.swipeEventOpt),this.opt.autoViewSlideOpt=Object.assign(Object.assign({},this.defualtOptions.autoViewSlideOpt),this.opt.autoViewSlideOpt),Array.isArray(this.opt.slide.preView)||(this.opt.slide.preView=[this.opt.slide.preView]),Array.isArray(this.opt.slide.step)||(this.opt.slide.step=[this.opt.slide.step]),this.opt.slide.preView.flat().includes(0)&&(this.opt.slide.preView=[1]),this.opt.slide.step.flat().includes(0)&&(this.opt.slide.step=this.opt.slide.preView),this.opt.slide.preView=this.opt.slide.preView.map((t=>{if(Array.isArray(t)){const e=t.reduce(((t,e)=>t+e),0),i=t.filter((t=>0===t)).length;t=t.map((t=>0===t?(100-e)/i:t))}else{const e=0===t?1:t;t=[];for(let i=0;i<Math.floor(e);i++)t.push(100/e)}return t})),this.opt.slide.step=this.opt.slide.step.map((t=>Array.isArray(t)?t.length:Math.floor(t))),this.opt.slide.step.every((t=>t===this.opt.slide.step[0]))&&(this.opt.slide.step=[this.opt.slide.step[0]])}#d(t,e,i){return Array.isArray(t)?t.map((t=>this.#d(t,e,i))):"number"==typeof t?Math.abs(t):(this.#r(i,"invalid value(!use defualt value!)"),e)}#a(t,e,i){return"boolean"==typeof t?t:(this.#r(i,"invalid value(!use defualt value!)"),e)}#p(t,e,i){if("string"==typeof t)if(t=t.trim(),"slidePosition"===i){if("left"===t||"center"===t||"right"===t||"auto"===t)return t}else if("autoViewSlideOptDirection"===i&&("left"===t||"right"===t))return t;return this.#r(i,"invalid value(!use defualt value!)"),e}#s(){let t="";if(this.$slides.forEach(((e,i)=>{e.setAttribute("data-mlider-index",i),t+=e.outerHTML})),this.$wrap.innerHTML="",this.$wrap.insertAdjacentHTML("afterbegin",`\n                <div class="sub-slide-line">\n                    <div class="slide-line">${t}</div>\n                </div>\n        `),this.$slides=Array.from(this.$slider.querySelectorAll(this.selectors.slideSelector)),this.$slideLine=this.$slider.querySelector(".slide-line"),this.$subSlideLine=this.$slider.querySelector(".sub-slide-line"),this.slideLngth=this.$slides.length,this.#c(this.opt),this.$wrap.setAttribute("data-mlider-type","wrapper"),this.$prevBtn&&this.$prevBtn.setAttribute("data-mlider-type","prev-btn"),this.$nextBtn&&this.$nextBtn.setAttribute("data-mlider-type","next-btn"),this.$dot){const t=this.$dot,e=this.$dot.parentElement;e.innerHTML="",t.setAttribute("data-mlider-type","dot");for(let i=0;i<this.mainSlideLngth;i++)t.setAttribute("data-mlider-index",i),this.opt.counterInDot&&(t.innerHTML=i),e.insertAdjacentHTML("beforeend",t.outerHTML);this.opt.dots=this.$slider.querySelectorAll(this.selectors.dotSelector)}}#c(t){this.stepLayout=[],this.styleLayout=[];for(let e=0,i=0;e<=this.slideLngth;){const s=t.slide.step[i%t.slide.step.length],n=this.slideLngth-e;if(!(n>s)){this.stepLayout.push(n);break}this.stepLayout.push(s),i++,e+=s}for(let e=0,i=0;e<=this.slideLngth;){const s=t.slide.preView[i%t.slide.preView.length],n=this.slideLngth-e;if(!(n>s.length)){this.styleLayout.push(s.slice(0,n));break}this.styleLayout.push(s),i++,e+=s.length}this.mainSlideLngth=this.stepLayout.length}#n(){this.opt.infinity&&(this.$subSlideLine.style.cssText+="\n                position: absolute;\n                left: 0;\n                top: 0;\n                height: 100%;\n                width: 100%;    \n            "),this.$slideLine.style.cssText+=`\n            position: absolute;\n            left: 0;\n            top: 0;\n            width: 100%;\n            height: 100%;\n            display: flex;\n            column-gap: ${this.opt.columnGap}px;\n            transition: transform ${this.opt.transitionTime/1e3}s ease;\n        `,this.$slides.forEach((t=>{t.style.cssText+="\n                height: 100%;\n                "})),this.#u(this.opt)}#u(){let t=0;for(let e=0;e<this.styleLayout.length;e++)for(let i=0;i<this.styleLayout[e].length;i++)this.$slides[t].style.flex=`0 0 calc(${this.styleLayout[e][i]}% - (${this.opt.columnGap}px \n                            - (${this.opt.columnGap}px / ${this.styleLayout[e].length})))`,t++}viewSlide(t=0){this.prevInd=this.curInd,this.curInd=this.#m(t),this.action=this.opt.mainSlideRect[this.curInd].pos-Math.floor(this.mainSlideLngth/2),this.opt.infinity&&this.slideShift(),this.opt.infinity&&(this.$subSlideLine.style.transform=`translateX(${this.opt.moveSlidePoint}px)`),this.$slideLine.style.transform=`translateX(${this.opt.mainSlideRect[this.curInd][this.opt.slide.position]}px)`,this.setCurrentClasses,this.opt.autoViewSlide&&this.#y()}slideShift(){for(let t=0;t<Math.abs(this.action);t++)if(this.action>0){for(let t=0;t<this.opt.rectByPos(0).step;t++){const e=this.opt.rectByPos(0).slides[t];this.$slideLine.insertAdjacentHTML("beforeend",`${e.outerHTML}`),e.remove()}this.opt.rectPosUpdate(1)}else if(this.action<0){for(let t=this.opt.rectByPos(this.mainSlideLngth-1).step-1;t>=0;t--){const e=this.opt.rectByPos(this.mainSlideLngth-1).slides[t];this.$slideLine.insertAdjacentHTML("afterbegin",`${e.outerHTML}`),e.remove()}this.opt.rectPosUpdate(-1)}this.#o()}#m(t){return this.opt.infinity?t>this.mainSlideLngth-1?t-=this.mainSlideLngth:t<0&&(t+=this.mainSlideLngth):t>this.mainSlideLngth-1?t=this.mainSlideLngth-1:t<0&&(t=0),t}#o(t){if(t){this.opt.wrapRect=this.$wrap.getBoundingClientRect(),this.opt.mainSlideRect=[],this.opt.secSlideRect=[],this.opt.moveSlidePoint=0;let t=0;for(let e=0;e<this.stepLayout.length;e++){const i={};let s=[],n=[],o=[],h=0;for(let i=0;i<this.stepLayout[e];i++){const e=this.$slides[t],i=e.getBoundingClientRect(),r=this.opt.wrapRect;s.push(-(i.left-r.left)),n.push(r.right-i.right),o.push(e),h+=i.width+this.opt.columnGap,t++}i.ind=e,i.pos=e,i.step=this.stepLayout[e],i.left=Math.max(...s),i.right=Math.min(...n),i.center=(i.left+i.right)/2,i.width=h,i.slides=o,this.opt.mainSlideRect.push(i)}this.opt.rectByPos=t=>{for(let e=0;e<this.mainSlideLngth;e++)if(this.opt.mainSlideRect[e].pos===t)return this.opt.mainSlideRect[e]},this.opt.rectPosUpdate=t=>{for(let e=0;e<this.mainSlideLngth;e++){const i=this.opt.mainSlideRect[e];i.pos=this.#m(i.pos-t)}}}else{for(let t=0;t<this.mainSlideLngth;t++){const e=this.opt.mainSlideRect[t];e.slides=e.slides.map((t=>this.$slideLine.querySelector(`[data-mlider-index="${t.getAttribute("data-mlider-index")}"]`)))}if(this.opt.infinity&&this.action&&0!==this.action){let t;if(t=this.action>0?this.opt.rectByPos(this.mainSlideLngth-1).width:this.opt.rectByPos(0).width,Math.abs(this.action)>1)if(t=0,this.action>0)for(let e=1;e<Math.abs(this.action)+1;e++)t+=this.opt.rectByPos(this.mainSlideLngth-e).width;else if(this.action<0)for(let e=0;e<Math.abs(this.action);e++)t+=this.opt.rectByPos(e).width;this.action>0?this.opt.moveSlidePoint+=t:this.opt.moveSlidePoint-=t}}this.#f()}#f(){for(let t=Math.abs(this.action);t>0;t--)if(this.action>0){const e=this.opt.rectByPos(this.mainSlideLngth-t),i=this.opt.rectByPos(this.mainSlideLngth-t-1);e.left=i.left-i.width,e.right=i.right-e.width,e.center=i.center-i.width/2-e.width/2}else if(this.action<0){const e=this.opt.rectByPos(t-1),i=this.opt.rectByPos(t);e.left=i.left+e.width,e.right=i.right+i.width,e.center=i.center+i.width/2+e.width/2}}#h(){this.$slider.addEventListener("click",this.mouseEvent.bind(this)),this.opt.keyboardEvent&&document.addEventListener("keydown",this.keyboardEvent.bind(this)),this.opt.swipeEvent&&(this.swipe=!1,this.swipePoint=0,this.swipeEvent=this.swipeEvent.bind(this),document.addEventListener("mousedown",this.swipeEvent),document.addEventListener("mousemove",this.swipeEvent),document.addEventListener("mouseup",this.swipeEvent)),this.opt.breakpoint&&window.addEventListener("resize",this.breakpointEvent.bind(this))}mouseEvent(t){const e=t.target;if(e.closest('[data-mlider-type="prev-btn"]'))this.viewSlide(this.curInd-1);else if(e.closest('[data-mlider-type="next-btn"]'))this.viewSlide(this.curInd+1);else if(e.closest('[data-mlider-type="dot"]')){const t=Number(e.closest('[data-mlider-type="dot"]').getAttribute("data-mlider-index"));this.viewSlide(t)}}keyboardEvent(t){const e=t.key,i=t.repeat;"ArrowLeft"!==e||i?"ArrowRight"!==e||i||this.viewSlide(this.curInd+1):this.viewSlide(this.curInd-1)}swipeEvent(t){const e=t.target,i=t.type;if("mousedown"===i&&e.closest('[data-mlider-type="wrapper"]')){this.swipe=!0;const t=this.opt.mainSlideRect[this.curInd].slides[0].getBoundingClientRect();this.swipePoint=this.prevLeftVal?this.prevLeftVal-t.left:0,this.$slideLine.style.transition="none"}else if("mousemove"===i&&this.swipe)this.swipePoint+=t.movementX*this.opt.swipeEventOpt.sensitivity,this.$slideLine.style.transform=`translate(${this.opt.mainSlideRect[this.curInd][this.opt.slide.position]+this.swipePoint}px, 0px)`;else if("mouseup"===i){this.swipe=!1,this.$slideLine.style.transition=`transform ${this.opt.transitionTime/1e3}s ease`;const t=this.opt.mainSlideRect[this.curInd][this.opt.slide.position],e=this.opt.mainSlideRect[this.curInd].pos;t+this.swipePoint<this.opt.rectByPos(e+1)[this.opt.slide.position]+500?this.viewSlide(this.curInd+1):t+this.swipePoint>this.opt.rectByPos(e-1)[this.opt.slide.position]-500?this.viewSlide(this.curInd-1):this.viewSlide(this.curInd),this.prevLeftVal=this.opt.mainSlideRect[this.curInd].slides[0].getBoundingClientRect().left}}breakpointEvent(t){document.documentElement.clientWidth}#y(){clearInterval(this.interval),this.interval=setInterval((()=>{"left"===this.opt.autoViewSlideOpt.direction?this.viewSlide(this.curInd-1):"right"===this.opt.autoViewSlideOpt.direction&&this.viewSlide(this.curInd+1)}),this.opt.autoViewSlideOpt.time)}get setCurrentClasses(){this.opt.mainSlideRect[this.prevInd].slides.forEach((t=>{t.classList.remove(this.opt.currentClass)})),this.opt.mainSlideRect[this.curInd].slides.forEach((t=>{t.classList.add(this.opt.currentClass)})),this.$dot&&(this.opt.dots[this.#g(this.prevInd)].classList.remove(this.opt.currentClass),this.opt.dots[this.#g(this.curInd)].classList.add(this.opt.currentClass)),this.$counter&&(this.$counter.innerHTML=`<span>${this.#g(this.curInd)}</span>/<span>${this.mainSlideLngth-1}</span>`)}get validKeyElements(){let t;return this.$slider&&this.$slides.length>0?t=!0:(t=!1,console.log("invalidKeyElements")),t}#g(t){for(;t>this.mainSlideLngth-1;)t-=this.mainSlideLngth;return t}}window.onload=()=>{new t({sliderSelector:"#mlider-1",slideSelector:".slide-mlider",prevBtnSelector:".mlider__btn_prev",nextBtnSelector:".mlider__btn_next",dotSelector:".mlider__dot",counterSelector:".mlider__counter"},{infinity:!0,columnGap:20,transitionTime:500,counterInDot:!0,keyboardEvent:!0,swipeEvent:!0,swipeEventOpt:{sensitivity:2},slideGroup:1,autoViewSlide:!1,autoViewSlideOpt:{time:0,direction:"right"},slide:{preView:[2.2,[35,45]],position:"center"},breakpoint:{1024:{slide:{preView:["2",[2,4]],position:"center"}},768:{}}})}})();